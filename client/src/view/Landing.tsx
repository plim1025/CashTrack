// REACT //
import React, { useState, useEffect } from 'react';

// ROUTER //
import { withRouter, RouteComponentProps } from 'react-router';

// REDUX //
import { useSelector } from 'react-redux';

// COMPONENTS //
import styled from 'styled-components';
import { Card, Jumbotron } from 'react-bootstrap';
import Button from '../components/shared/Button';
import FallbackSpinner from '../components/shared/FallbackSpinner';

// TYPES //
import { RootState } from '../types';

const Landing: React.FC<RouteComponentProps> = props => {
    const reduxEmail = useSelector((redux: RootState) => redux.email);
    const sessionEmail = sessionStorage.getItem('email');
    const [loading, setLoading] = useState(false);

    useEffect(() => {
        if (reduxEmail || sessionEmail) {
            props.history.push('/transactions');
        }
    }, []);

    const loginAsGuest = async () => {
        setLoading(true);
        try {
            const response = await fetch('/api/user/signin', {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email: 'guest@gmail.com', password: 'password' }),
            });
            if (!response.ok) {
                throw Error('Bad response from server');
            }
            sessionStorage.setItem('email', 'guest@gmail.com');
            props.history.push('/transactions');
        } catch {
            throw Error('Error logging in as guest');
        }
        setLoading(false);
    };

    return (
        <Wrapper>
            <JumbotronWrapper>
                <Logo onClick={() => props.history.push('/landing')} viewBox='0 0 1698.4 493'>
                    <path d='M470.9,13.2C450,4.7,422.7,0,394,0s-56,4.7-76.9,13.2c-31.8,13-39.6,31.1-40.9,42.8H276V217.8c-6.5-.5-13.2-.8-20-.8s-13.5.3-20,.8V136h-.2c-1.3-11.7-9-29.8-40.9-42.8C174,84.7,146.7,80,118,80S62,84.7,41.1,93.2C5.3,107.8,0,128.8,0,140V376c0,11.2,5.3,32.2,41.1,46.8C62,431.3,89.3,436,118,436c6.8,0,13.5-.3,20.1-.8.7,11.6,7.5,30.9,41,44.6C200,488.3,227.3,493,256,493s56-4.7,76.9-13.2C368.7,465.2,374,444.2,374,433v-.8c6.6.5,13.2.8,20,.8,28.7,0,56-4.7,76.9-13.2C506.7,405.2,512,384.2,512,373V60C512,48.8,506.7,27.8,470.9,13.2ZM394,40c46.2,0,72.9,13.5,77.6,20-4.7,6.5-31.4,20-77.6,20s-72.9-13.5-77.6-20C321.1,53.5,347.8,40,394,40ZM256,257c46.2,0,72.9,13.5,77.6,20h-.1l-.3.3-.3.4-.3.3-.4.4-.3.3-.5.4-.4.4a1,1,0,0,0-.5.4l-.5.3-.6.5-.6.3-.7.5-.6.3-.8.5-.6.4-.9.5-.6.3-1.1.5-.6.4-1.4.6-.4.2-2,.9h-.3l-1.7.7-.8.3-1.4.6-1,.3-1.4.5-1,.3-1.4.5-1.1.4-1.5.4-1.2.3-1.5.5-1.3.3-1.6.4-1.3.3-1.6.4-1.4.3-1.7.4-1.5.3-1.8.3-1.5.3-1.8.3-1.6.3-1.9.3-1.6.2-2,.2-1.7.2-2.1.3h-1.7l-2.1.2-1.8.2h-4l-2.5.2H245.7l-2.5-.2h-4l-1.8-.2-2.1-.2h-1.7l-2.1-.3-1.7-.2-2-.2-1.6-.2-1.9-.3-1.6-.3-1.8-.3-1.5-.3-1.8-.3-1.5-.3-1.7-.4-1.4-.3-1.6-.4-1.3-.3-1.6-.4-1.3-.3-1.5-.5-1.2-.3-1.5-.4-1.1-.4-1.4-.5-1-.3L198,288l-.9-.3-1.4-.6-.8-.3-1.7-.7h-.4l-1.9-.9-.4-.2-1.4-.6-.6-.4-1.1-.5-.6-.3-.9-.5-.7-.4-.7-.5-.6-.3-.7-.5-.6-.3-.6-.5-.5-.3a1,1,0,0,0-.5-.4c-.1-.2-.3-.3-.4-.4l-.5-.4-.3-.3-.4-.4-.3-.3-.3-.4-.3-.3h-.1C183.1,270.5,209.8,257,256,257ZM118,120c46.2,0,72.9,13.5,77.6,20-4.7,6.5-31.4,20-77.6,20s-72.9-13.5-77.6-20C45.1,133.5,71.8,120,118,120Zm20,275.1c-6.5.6-13.2.9-20,.9-47.8,0-74.7-14.5-78-20.6V345.3l1.1.5C62,354.3,89.3,359,118,359c6.8,0,13.4-.3,20-.8ZM138,280v38.1c-6.5.6-13.2.9-20,.9-47.9,0-74.8-14.5-78-20.7v-33l1.1.5C62,274.3,89.3,279,118,279c6.8,0,13.5-.3,20-.8,0,.6.1,1.2.1,1.8Zm-20-41c-47.9,0-74.8-14.5-78-20.7v-32l1.1.5C62,195.3,89.3,200,118,200s56-4.7,76.9-13.2l1.1-.5v32C192.8,224.5,165.9,239,118,239ZM334,432.4c-3.3,6.1-30.2,20.6-78,20.6s-74.7-14.5-78-20.6V400.3l1.1.5C200,409.3,227.3,414,256,414s56-4.7,76.9-13.2l1.1-.5Zm0-79.1c-3.2,6.2-30.1,20.7-78,20.7s-74.8-14.5-78-20.7v-30l1.1.5C200,332.3,227.3,337,256,337s56-4.7,76.9-13.2l1.1-.5Zm138,19.1c-3.3,6.1-30.2,20.6-78,20.6-6.8,0-13.5-.3-20-.9V355.2c6.6.5,13.2.8,20,.8,28.7,0,56-4.7,76.9-13.2l1.1-.5Zm0-77.1c-3.2,6.2-30.1,20.7-78,20.7-6.8,0-13.5-.3-20-.9V280h-.1c0-.6.1-1.2.1-1.8,6.5.5,13.2.8,20,.8,28.7,0,56-4.7,76.9-13.2l1.1-.5Zm0-77c-3.2,6.2-30.1,20.7-78,20.7s-74.8-14.5-78-20.7v-33l1.1.5C338,194.3,365.3,199,394,199s56-4.7,76.9-13.2l1.1-.5Zm0-80c-3.2,6.2-30.1,20.7-78,20.7s-74.8-14.5-78-20.7v-32l1.1.5C338,115.3,365.3,120,394,120s56-4.7,76.9-13.2l1.1-.5Z' />
                    <LogoText transform='translate(665 297)'>CashTrack</LogoText>
                </Logo>
                <Headline>A one-stop tool for managing your financial life</Headline>
                <ButtonWrapper>
                    <Button
                        child='Sign In'
                        size='lg'
                        onClick={() => props.history.push('/signin')}
                        style={{ width: 130 }}
                    />
                    <Button
                        child='Register'
                        variant='success'
                        size='lg'
                        onClick={() => props.history.push('/register')}
                        style={{ width: 130 }}
                    />
                </ButtonWrapper>
                <Button
                    onClick={loginAsGuest}
                    child='Sign in as Guest'
                    variant='link'
                    style={{ marginTop: 10 }}
                />
            </JumbotronWrapper>
            <CardWrapper>
                <CardTile>
                    <CardIcon viewBox='0 0 512 512'>
                        <path d='M496.47,464.908h-16.532V440.36c0-4.15-3.365-7.515-7.515-7.515H455.89V263.515h24.548c4.15,0,7.515-3.365,7.515-7.515 v-64.125c0-4.15-3.365-7.515-7.515-7.515h-29.043L261.2,2.089c-2.907-2.785-7.493-2.785-10.399,0L60.604,184.36H31.562 c-4.15,0-7.515,3.365-7.515,7.515V256c0,4.15,3.365,7.515,7.515,7.515H56.11v169.331H39.577c-4.15,0-7.515,3.365-7.515,7.515 v24.548H15.53c-4.15,0-7.515,3.365-7.515,7.515v32.063c0,4.15,3.365,7.515,7.515,7.515H496.47c4.15,0,7.515-3.365,7.515-7.515 v-32.063C503.984,468.273,500.62,464.908,496.47,464.908z M39.076,248.485v-49.096H348.18c4.15,0,7.515-3.365,7.515-7.515 s-3.365-7.515-7.515-7.515H82.327L256,17.923L429.673,184.36h-44.754c-4.15,0-7.515,3.365-7.515,7.515s3.365,7.515,7.515,7.515 h88.005v49.096H39.076z M440.861,263.515v169.331h-25.049V263.515H440.861z M400.783,263.515v169.331h-25.049V263.515H400.783z M360.705,263.515v169.331h-25.049V263.515H360.705z M320.626,263.515v169.331H191.374V263.515H320.626z M176.344,263.515v169.331 h-25.049V263.515H176.344z M136.266,263.515v169.331h-25.049V263.515H136.266z M96.188,263.515v169.331H71.139V263.515H96.188z M47.092,447.875h417.816v17.033H47.092V447.875z M488.955,496.971H23.045v-17.033h465.91V496.971z' />
                        <path d='M276.841,340.064c4.15,0,7.515-3.365,7.515-7.515v-5.21c0-11.984-9.156-21.87-20.841-23.03v-8.231 c0-4.15-3.365-7.515-7.515-7.515s-7.515,3.365-7.515,7.515v8.591c-11.858,2.299-20.841,12.755-20.841,25.275 c0,14.199,11.552,25.75,25.75,25.75h5.21c5.912,0,10.721,4.809,10.721,10.721s-4.809,10.721-10.721,10.721h-7.815 c-4.475,0-8.116-3.641-8.116-8.116c0-4.15-3.365-7.515-7.515-7.515s-7.515,3.365-7.515,7.515c0,11.984,9.156,21.87,20.841,23.03 v8.231c0,4.15,3.365,7.515,7.515,7.515s7.515-3.365,7.515-7.515v-8.591c11.858-2.299,20.841-12.755,20.841-25.275 c0-14.199-11.552-25.75-25.75-25.75h-5.21c-5.912,0-10.721-4.809-10.721-10.721s4.809-10.721,10.721-10.721h7.815 c4.475,0,8.116,3.641,8.116,8.116v5.21C269.326,336.7,272.691,340.064,276.841,340.064z' />
                        <path d='M256,72.141c-26.242,0-47.593,21.351-47.593,47.593c0,26.242,21.351,47.593,47.593,47.593s47.593-21.351,47.593-47.593 S282.243,72.141,256,72.141z M256,152.297c-17.955,0-32.564-14.609-32.564-32.564c0-17.955,14.609-32.564,32.564-32.564 s32.564,14.609,32.564,32.564C288.564,137.689,273.956,152.297,256,152.297z' />
                    </CardIcon>
                    <CardTitle>Live transactions from any bank account</CardTitle>
                </CardTile>
                <CardTile>
                    <CardIcon viewBox='0 0 512 512'>
                        <path d='m120 264h24v16h-24z' />
                        <path d='m176 304h24v16h-24z' />
                        <path d='m120 304h40v16h-40z' />
                        <path d='m56 304h48v16h-48z' />
                        <path d='m104 344h96v16h-96z' />
                        <path d='m56 344h32v16h-32z' />
                        <path d='m152 384h48v16h-48z' />
                        <path d='m56 384h80v16h-80z' />
                        <path d='m104 424h48v16h-48z' />
                        <path d='m56 424h32v16h-32z' />
                        <path d='m480 240a8.00008 8.00008 0 0 0 -8-8h-48a8.00008 8.00008 0 0 0 -8 8v40h-40a8.00008 8.00008 0 0 0 -8 8v40h-40a8.00008 8.00008 0 0 0 -8 8v40h-40a8.00008 8.00008 0 0 0 -8 8v48h-57.37622a24 24 0 1 0 0 16h9.37622v24a8.00917 8.00917 0 0 1 -8 8h-176a8.00917 8.00917 0 0 1 -8-8v-184h40a24.0275 24.0275 0 0 0 24-24v-40h120a8.00917 8.00917 0 0 1 8 8v8h16v-8a24.0275 24.0275 0 0 0 -24-24h-121.37305a23.84385 23.84385 0 0 0 -16.9707 7.02979l-54.62695 54.627a23.84254 23.84254 0 0 0 -7.0293 16.97065v185.37256a24.0275 24.0275 0 0 0 24 24h176a24.0275 24.0275 0 0 0 24-24v-24h256v-16h-16zm-400-4.686v28.686a8.00917 8.00917 0 0 1 -8 8h-28.686zm112 212.686a8 8 0 1 1 8-8 8.00917 8.00917 0 0 1 -8 8zm96-56h32v40h-32zm48-48h32v88h-32zm48-48h32v136h-32zm48 136v-184h32v184z' />
                        <path d='m40 216a23.99448 23.99448 0 0 0 21.65479-34.3407l24.00439-24.00464a23.9887 23.9887 0 0 0 32.9646-13.65466h34.75244a23.99529 23.99529 0 0 0 46.29028-4.03479l45.179-38.72473a24.00054 24.00054 0 1 0 -10.88281-11.745l-38.27324 32.80552a23.98335 23.98335 0 0 0 -42.31323 5.699h-34.75244a23.99718 23.99718 0 1 0 -44.27857 18.3407l-24.00439 24.00464a23.99872 23.99872 0 1 0 -10.34082 45.65466zm216-144a8 8 0 1 1 -8 8 8.00917 8.00917 0 0 1 8-8zm-80 56a8 8 0 1 1 -8 8 8.00917 8.00917 0 0 1 8-8zm-80 0a8 8 0 1 1 -8 8 8.00917 8.00917 0 0 1 8-8zm-56 56a8 8 0 1 1 -8 8 8.00917 8.00917 0 0 1 8-8z' />
                        <path d='m329.56543 203.12067-52.87891 52.87933h-70.06274a24 24 0 1 0 0 16h17.37622v144h16v-144h40a8.00076 8.00076 0 0 0 5.65723-2.34326l57.73777-57.73774a104.28417 104.28417 0 1 0 -13.82959-8.79828zm-145.56543 68.87933a8 8 0 1 1 8-8 8.00917 8.00917 0 0 1 -8 8zm272.17041-91.85022-46.35547-52.14978h69.81738a87.7058 87.7058 0 0 1 -23.46191 52.14978zm23.46191-68.14978h-79.63232v-79.63251a88.14413 88.14413 0 0 1 79.63232 79.63251zm-95.63232-79.63251v87.63251a7.95881 7.95881 0 0 0 2.02734 5.30908l-.00683.00586 58.19726 65.47211a87.98307 87.98307 0 1 1 -60.21777-158.41956z' />
                    </CardIcon>
                    <CardTitle>Visualize your spending habits </CardTitle>
                </CardTile>
                <CardTile>
                    <CardIcon viewBox='0 0 64 64'>
                        <path d='m56.526 30.376-.172-.316 5.318-5.318c.856-.856 1.328-1.995 1.328-3.206 0-2.501-2.035-4.536-4.536-4.536-.508 0-.997.101-1.464.26v-13.26c0-1.654-1.346-3-3-3h-31.171c-.801 0-1.555.312-2.122.879l-8.828 8.828c-.567.566-.879 1.32-.879 2.122v2.222c-5.598.507-10 5.221-10 10.949v32c0 2.757 2.243 5 5 5h12c2.757 0 5-2.243 5-5v-1h24 1 14.181l-2.184-13.104c-.018-4.711-1.215-9.384-3.471-13.52zm1.45 12.867-9.749 2.659-2.351-1.881c-1.192-.955-1.876-2.378-1.876-3.905v-8.116-1c1.103 0 2 .897 2 2v7h2v-1.586l6.874-6.874c1.923 3.6 2.984 7.624 3.102 11.703zm-13.976-14.243c-1.103 0-2 .897-2 2v1c0 .551-.449 1-1 1s-1-.449-1-1v-1c0-2.206 1.794-4 4-4h2.586l-2.054 2.054c-.176-.024-.35-.054-.532-.054zm-10.951 17.072 1.316-3.292 2.855 2.855-3.293 1.317c-.423.172-.927-.169-.927-.629 0-.087.016-.171.049-.251zm5.951-1.486-3.586-3.586 6.047-6.047c.187-.029.366-.076.539-.138v5.3c0 .454.052.898.136 1.334zm-.816-11.586h-11.184v-4h11.35c-.222.627-.35 1.298-.35 2v1c0 .352.072.686.184 1zm-11.184 2h11.586l-4 4h-7.586zm0 6h5.923l-1.6 4h-4.323zm0 6h4.098c.302 1.147 1.339 2 2.58 2 .343 0 .678-.064.994-.191l2.328-.932v3.123h-10zm12 .077.562-.225 3.33-3.33c.036.065.069.131.108.195v7.283h-4zm6-1.197 2 1.6v3.52h-2zm16-24.344c0 .677-.264 1.314-.743 1.793l-12.257 12.257v-2.586c0-1.252-.59-2.358-1.494-3.092l10.165-10.165c.479-.479 1.116-.743 1.793-.743 1.398 0 2.536 1.138 2.536 2.536zm-40-17.122v5.586c0 .551-.449 1-1 1h-5.586zm-9 12.586c4.962 0 9 4.038 9 9s-4.038 9-9 9-9-4.038-9-9 4.038-9 9-9zm-5 18.786c1.502.77 3.199 1.214 5 1.214s3.498-.444 5-1.214v5.214h-10zm11 25.214h-12c-1.654 0-3-1.346-3-3v-25.695c.569.81 1.239 1.544 2 2.174v6.521c0 1.103.897 2 2 2h10c1.103 0 2-.897 2-2v-6.521c.761-.63 1.431-1.364 2-2.174v25.695c0 1.654-1.346 3-3 3zm5-6v-29c0-5.728-4.402-10.442-10-10.949v-2.051h7c1.654 0 3-1.346 3-3v-7h31c.551 0 1 .449 1 1v14.586l-6.414 6.414h-4.586c-1.771 0-3.36.776-4.46 2h-14.54v26h22v2zm26 0v-7.236l9.195-2.508 1.624 9.744z' />
                        <path d='m11 30.855v2.145h2v-2.145c1.155-.366 2-1.435 2-2.709 0-1.087-.604-2.066-1.578-2.553l-1.95-.974c-.291-.146-.472-.439-.472-.765 0-.471.383-.854.854-.854h.292c.471 0 .854.383.854.854v1.146h2v-1.146c0-1.274-.845-2.343-2-2.709v-2.145h-2v2.145c-1.155.366-2 1.435-2 2.709 0 1.087.604 2.066 1.578 2.553l1.95.974c.291.146.472.439.472.765 0 .471-.383.854-.854.854h-.292c-.471 0-.854-.383-.854-.854v-1.146h-2v1.146c0 1.274.845 2.343 2 2.709z' />
                        <path d='m17 45h-10c-1.103 0-2 .897-2 2v10c0 1.103.897 2 2 2h10c1.103 0 2-.897 2-2v-10c0-1.103-.897-2-2-2zm0 4h-2v-2h2zm-4 8h-2v-2h2zm0-4h-2v-2h2zm-4 0h-2v-2h2zm2-4v-2h2v2zm-2-2v2h-2v-2zm-2 8h2v2h-2zm8 2v-6h2.001l.001 6z' />
                        <path d='m53 5h-28v6h28zm-2 4h-24v-2h24z' />
                        <path d='m25 13h28v2h-28z' />
                        <path d='m25 17h28v2h-28z' />
                        <path d='m25 21h16v2h-16z' />
                    </CardIcon>
                    <CardTitle>Create custom budgets</CardTitle>
                </CardTile>
            </CardWrapper>
            <Footer>
                <FooterItem>Copyright © CashTrack 2020</FooterItem>
                <FooterItem>cashtrackapp78@gmail.com</FooterItem>
            </Footer>
            <FallbackSpinner backdrop show={loading} />
        </Wrapper>
    );
};

// STYLES //
const Wrapper = styled.div`
    align-items: center;
    display: flex;
    flex-direction: column;
`;

const JumbotronWrapper = styled(Jumbotron)`
    align-items: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    width: 100%;
    &&& {
        background-color: #fff;
    }
`;

const Logo = styled.svg`
    cursor: pointer;
    fill: #343a40;
    &&& {
        height: 120px;
        width: 480px;
    }
`;

const LogoText = styled.text`
    font-family: 'Open Sans';
    font-size: 200px;
    font-weight: 600;
`;

const Headline = styled.div`
    color: #343a40;
    font-weight: 700;
    margin: 20px 0;
`;

const ButtonWrapper = styled.div`
    display: flex;
    & button {
        margin: 0 10px;
    }
`;

const CardWrapper = styled.div`
    display: flex;
    max-width: 800px;
    width: calc(100% - 40px);
`;

const CardTitle = styled(Card.Title)`
    color: #343a40;
    font-size: 1.25rem;
    padding: 20px;
    &&& {
        margin-bottom: 0;
    }
`;

const CardTile = styled(Card)`
    flex: 1;
    margin: 0 10px;
`;

const CardIcon = styled.svg`
    fill: #343a40;
    height: auto;
    padding: 0 20px;
    padding-top: 20px;
    width: 100%;
`;

const Footer = styled.div`
    display: flex;
    justify-content: center;
    margin: 20px 0;
    max-width: 800px;
    width: calc(100% - 40px);
`;

const FooterItem = styled.div`
    margin: 0 20px;
`;

export default withRouter(Landing);
